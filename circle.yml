machine:
  node:
    version: 6.9.4

  services:
    - docker

  environment:
    REPO:        creasty/site
    K8S_VERSION: v1.5.7
    BRANCH:      $(echo $TRAVIS_BRANCH | sed -e 's/[^a-zA-Z0-9]/_/g')
    TAG:         $BRANCH-${TRAVIS_COMMIT::8}
    # K8S_SERVER
    # K8S_TOKEN

dependencies:
  cache_directories:
    - node_modules
  pre:
    - |
      set -e
      curl -o ./kubectl "https://storage.googleapis.com/kubernetes-release/release/${K8S_VERSION}/bin/linux/amd64/kubectl"
      chmod +x ./kubectl
  override:
    - yarn

test:
  override:
    - script/ci-build

deployment:
  production:
    branch: master
    commands: script/ci-deploy
